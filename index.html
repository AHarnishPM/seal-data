<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seal and Serpent Lineage Tracking Form</title>
    <!-- Include Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap">
    <!-- Treant.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.css">
    <!-- Treant.js JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/vendor/raphael.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.min.js"></script>
    <style>
        /* Your existing styles */
        body {
            font-family: 'Open Sans', Arial, sans-serif;
            padding: 0;
            margin: 0;
            background-color: #FFF9C4; /* Light yellow background */
        }
        /* ... existing styles ... */

        /* Family Tree Section Styles */
        #familyTreeSection {
            margin-top: 50px;
            text-align: center;
        }
        #familyTree {
            width: 100%;
            height: 600px;
            overflow: auto;
            border: 1px solid #ccc;
            margin: 0 auto;
        }
        .Treant {
            position: relative;
        }
        .node {
            text-align: center;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            background-color: #FBC02D;
            color: #000;
        }
        .node-name {
            font-weight: bold;
        }
        .node-title {
            font-size: 12px;
            color: #555;
        }
        @media (max-width: 600px) {
            input {
                width: 100%;
            }
            #leaderboard table {
                width: 100%;
            }
            #familyTree {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Seal and Serpent Lineage Tracking Form</h1>
        <p>I created this form in an effort to track lineages back as far as possible and make some cool graphs of our society over time to share with actives and alumni. With a black book from around every other year, we can trace our entire lineage back to whenever we started keeping track.</p>
        <p>Please enter information for any members whom you know or have a black book containing, following the formatting outlined in grey inside the boxes.</p>
        <p>Enter your name in the first box to count towards the leaderboard. Use full, legal first and last names for all members and 4 digits for the year, as due to our age, we have members from 1927 and 2027.</p>
        <p>Thank you for helping! If you have any questions, email me at <a href="mailto:ajh374@cornell.edu">ajh374@cornell.edu</a></p>
        <p>- Aaron Harnish, 2027</p>

        <!-- Submitter's Name Field (Outside the Form) -->
        <input type="text" id="submitterName" placeholder="Your Name (e.g., Edward Tinkham)" required><br>

        <!-- Member Form -->
        <form id="memberForm">
            <input type="text" id="memberName" placeholder="Member's Name (e.g., Aaron Harnish)" required><br>
            <input type="text" id="gradYear" placeholder="Member Graduation Year (e.g., 2027)" required><br>
            <input type="text" id="bigName" placeholder="Member's Big's Name (e.g., Cedric Orton-Urbina)" required><br>
            <button type="button" id="addEntryButton">Add Entry</button>
            <p id="message"></p>
        </form>

        <!-- Search Section -->
        <!-- ... existing search section ... -->

        <!-- Leaderboard Section -->
        <!-- ... existing leaderboard section ... -->

        <!-- Family Tree Section -->
        <div id="familyTreeSection">
            <h2>Family Tree</h2>
            <div id="familyTree"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase Configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getFirestore,
            addDoc,
            collection,
            query,
            where,
            getDocs,
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "seal-data-collection.firebaseapp.com",
            projectId: "seal-data-collection",
            storageBucket: "seal-data-collection.appspot.com",
            messagingSenderId: "17642329541",
            appId: "1:17642329541:web:39d214d2f5c8b01ce2a7ac",
            measurementId: "G-BMCBQ5S8QV"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Attach event listeners after the DOM is fully loaded
        document.addEventListener("DOMContentLoaded", () => {
            // Existing code...
            document.getElementById("addEntryButton").addEventListener("click", addEntry);
            document.getElementById("searchButton").addEventListener("click", searchMember);
            // Load the leaderboard
            loadLeaderboard();
            // Load the family tree
            loadFamilyTree();
        });

        // Function to load the family tree
        async function loadFamilyTree() {
            try {
                // Fetch all entries from Firestore
                const entriesSnapshot = await getDocs(collection(db, "mentorship"));
                const members = [];

                // Build an array of member objects
                entriesSnapshot.forEach((doc) => {
                    const data = doc.data();
                    members.push({
                        memberName: data.memberName,
                        bigName: data.bigName,
                        gradYear: data.gradYear,
                    });
                });

                // Build the tree data
                const treeConfig = buildTreeConfig(members);

                // Visualize the tree
                new Treant(treeConfig);

            } catch (error) {
                console.error("Error loading family tree:", error);
            }
        }

        // Function to build tree config for Treant.js
        function buildTreeConfig(members) {
            const memberMap = {};
            const nodes = {};
            const roots = [];

            // Create node configs
            members.forEach(member => {
                memberMap[member.memberName] = member;
                nodes[member.memberName] = {
                    text: {
                        name: member.memberName,
                        title: "Grad Year: " + member.gradYear
                    },
                    HTMLclass: 'node',
                    children: []
                };
            });

            // Build the tree by linking nodes
            members.forEach(member => {
                const node = nodes[member.memberName];
                if (member.bigName && nodes[member.bigName]) {
                    nodes[member.bigName].children.push(node);
                } else {
                    roots.push(node);
                }
            });

            // If there's only one root, use it; otherwise, create a dummy root
            const chartConfig = {
                chart: {
                    container: "#familyTree",
                    rootOrientation: "NORTH", // Vertical orientation
                    levelSeparation: 30,
                    siblingSeparation: 20,
                    subTeeSeparation: 30,
                    scrollbar: "native",
                    connectors: {
                        type: "step"
                    },
                    node: {
                        HTMLclass: "node",
                        collapsable: true
                    },
                    animation: {
                        nodeAnimation: "easeOutBounce",
                        nodeSpeed: 700,
                        connectorsAnimation: "bounce",
                        connectorsSpeed: 700
                    }
                },
                nodeStructure: {}
            };

            if (roots.length === 1) {
                chartConfig.nodeStructure = roots[0];
            } else {
                chartConfig.nodeStructure = {
                    text: { name: "Root" },
                    children: roots,
                    HTMLclass: 'node'
                };
            }

            return chartConfig;
        }

        // Existing functions: addEntry(), loadLeaderboard(), searchMember()
        // ... include these functions as they were in your code ...
    </script>
</body>
</html>