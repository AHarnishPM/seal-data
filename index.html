<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seal and Serpent Lineage Tracking Form</title>
    <style>
        /* Your existing styles */
        body {
            font-family: Arial, sans-serif;
            padding: 0;
            margin: 0;
            background-color: #FFF9C4; /* Light yellow background */
        }
        .container {
            max-width: 800px;
            margin: 0 auto; /* Center the container */
            padding: 20px;
            text-align: center; /* Center-align text */
        }
        h1 {
            color: #F57F17; /* Darker yellow/gold */
        }
        p {
            color: #555; /* Dark gray for readability */
            font-size: 18px;
            line-height: 1.6;
        }
        form {
            margin-top: 30px;
        }
        input {
            margin: 10px 0;
            padding: 10px;
            width: 80%;
            max-width: 400px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input::placeholder {
            color: #999;
        }
        button {
            padding: 12px 25px;
            margin-top: 20px;
            cursor: pointer;
            background-color: #FBC02D; /* Medium yellow */
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #F9A825; /* Darker yellow on hover */
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        @media (max-width: 600px) {
            input {
                width: 100%;
            }
        }
        /* Add margin to separate the submitter's name field */
        #submitterName {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Seal and Serpent Lineage Tracking Form</h1>
        <p>I created this form in an effort to track lineages back as far as possible and make some cool graphs of our society over time to share with actives and alumni. With a black book from around every other year, we can trace our entire lineage back to whenever we started keeping track.</p>
        <p>In the coming days, I will add a login system and leaderboard for who can submit the most members, with perhaps a reward for top contributors. Please enter information for any members whom you know or have a black book containing, following the formatting outlined in grey inside the boxes.</p>
        <p>Use full, legal first and last names for all members and 4 digits for the year, as due to our age, we have members from 1927 and 2027.</p>
        <p>Thank you for helping! If you have any questions, email me at <a href="mailto:ajh374@cornell.edu">ajh374@cornell.edu</a></p>
        <p>- Aaron Harnish, 2027</p>

        <!-- Submitter's Name Field (Outside the Form) -->
        <input type="text" id="submitterName" placeholder="Your Name (e.g., John O'Connor)" required><br>

        <!-- Member Form -->
        <form id="memberForm">
            <input type="text" id="memberName" placeholder="Member's Name (e.g., Aaron Smith-Jones)" required><br>
            <input type="text" id="gradYear" placeholder="Member Graduation Year (e.g., 2027)" required><br>
            <input type="text" id="bigName" placeholder="Member's Big's Name (e.g., Cedric O'Brien)" required><br>
            <button type="button" id="addEntryButton">Add Entry</button>
            <p id="message"></p>
        </form>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase Configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getFirestore,
            addDoc,
            collection,
            query,
            where,
            getDocs
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "seal-data-collection.firebaseapp.com",
            projectId: "seal-data-collection",
            storageBucket: "seal-data-collection.appspot.com",
            messagingSenderId: "17642329541",
            appId: "1:17642329541:web:39d214d2f5c8b01ce2a7ac",
            measurementId: "G-BMCBQ5S8QV"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Attach the event listener to the button after the DOM is loaded
        document.addEventListener("DOMContentLoaded", () => {
            // Retrieve and set the submitter's name from local storage if available
            const savedName = localStorage.getItem('submitterName');
            if (savedName) {
                document.getElementById("submitterName").value = savedName;
            }
            document.getElementById("addEntryButton").addEventListener("click", addEntry);
        });

        async function addEntry() {
            const memberName = document.getElementById("memberName").value.trim();
            const bigName = document.getElementById("bigName").value.trim();
            const gradYear = document.getElementById("gradYear").value.trim();
            const submitterName = document.getElementById("submitterName").value.trim();
            const message = document.getElementById("message");

            // Validate that gradYear is a 4-digit number
            const gradYearPattern = /^\d{4}$/;
            if (!gradYearPattern.test(gradYear)) {
                message.textContent = "Graduation year must be a 4-digit number.";
                message.className = "error";
                return;
            }

            // Ensure all required fields are filled
            if (!memberName || !bigName || !gradYear || !submitterName) {
                message.textContent = "All fields are required.";
                message.className = "error";
                return;
            }

            // Update name validation regex to allow letters, spaces, hyphens, and apostrophes
            const namePattern = /^[a-zA-Z\s'-]+$/;
            if (
                !namePattern.test(memberName) ||
                !namePattern.test(bigName) ||
                !namePattern.test(submitterName)
            ) {
                message.textContent = "Names can only contain letters, spaces, hyphens, and apostrophes.";
                message.className = "error";
                return;
            }

            // Save submitter's name to local storage
            localStorage.setItem('submitterName', submitterName);

            try {
                // Check for duplicates
                const q = query(
                    collection(db, "mentorship"),
                    where("memberName", "==", memberName),
                    where("gradYear", "==", gradYear)
                );
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    // Duplicate found
                    message.textContent = "This member and graduation year already exist.";
                    message.className = "error";
                    return;
                }

                // Add entry to Firestore
                await addDoc(collection(db, "mentorship"), {
                    memberName,
                    gradYear,
                    bigName,
                    submittedBy: submitterName,
                    timestamp: new Date()
                });

                message.textContent = "Entry added successfully!";
                message.className = "success";

                // Reset the form but not the submitter's name
                document.getElementById("memberForm").reset();
                // Keep the submitter's name intact

            } catch (error) {
                console.error("Error adding document:", error);
                message.textContent = "Failed to add entry.";
                message.className = "error";
            }
        }
    </script>
</body>
</html>